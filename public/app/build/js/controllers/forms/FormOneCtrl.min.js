"use strict";angular.module("BfcApp").controller("FormOneCtrl",["$scope","$state","$rootScope","$stateParams","toaster","FormService","$filter","$http","underscore","QuestionService","UserService","CommentService",function(e,t,n,s,o,a,i,u,r,c,d,l){function _(){a.Show(s.form_id).then(function(t){function n(e){var n=r.find(t.data.questions,function(t){return t.position==e});return"undefined"!=typeof n&&(n.check=!0),n}if(e.q_data=[],e.save=function(t){c.Update(e.questions[t].id,JSON.stringify(e.questions[t].data)).then(function(e){o.pop("success","Success!","")})},e.questions=[],e.questions[1]=n(1),e.questions[1]){r.isEmpty(e.questions[1].data)?e.questions[1].data=[["Currency",""],["Current unit",""],["Bank only of consolidated",""]]:e.questions[1].data=JSON.parse(e.questions[1].data);var s,a=document.getElementById("question_1");s=new Handsontable(a,{data:e.questions[1].data,cells:function(e,t){var n;return 1===e&&1===t?n={type:"dropdown",source:["Unit","thousand","million"]}:2===e&&1===t?n={type:"dropdown",source:["Bank Only","Consolidated"]}:void 0}})}if(e.questions[2]=n(2),e.questions[2]&&(r.isEmpty(e.questions[2].data)?e.questions[2].data={check_1:"",check_2:"",check_3:"",check_4:""}:e.questions[2].data=JSON.parse(e.questions[2].data)),e.questions[3]=n(3),e.questions[3]){r.isEmpty(e.questions[3].data)?e.questions[3].data=[["","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["Principal or interest is 90 days or more past due","","","",""],["The bank has placed the exposure in non-accural status","","","",""],["Restructured within the last 12 months","","","",""],["Full repayment is doubtful even if current or less than 90 days past due","","","",""],["Total NPL","","","",""],["","","","",""],["Gross loans","","","",""],["ADB NPL ratio","","","",""],["","","","",""],["ADB NPL ratio covenant","","","",""]]:e.questions[3].data=JSON.parse(e.questions[3].data);var i,u=document.getElementById("question_3");i=new Handsontable(u,{data:e.questions[3].data})}if(e.questions[4]=n(4),e.questions[4]){r.isEmpty(e.questions[4].data)?e.questions[4].data=[["Non accural loans","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["Non-accrual loans that are current or <90 days past due","","","",""],["Non-accrual loans that are >90 days","","","",""],["Total Non-accrual Loans "," -   "," -   "," -   "," -   "],["","","","",""],["Non accural loans","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["Non-accrual loans that are current or <90 days past due","","","",""],["Non-accrual loans that are >90 days","","","",""],["Total Non-accrual Loans "," -   "," -   "," -   "," -   "],["","","","",""],["Restructured loans","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["Loans restructured within the past 12 months (outstanding balance amount only)","","","",""],["Loans restructured within the past 12 months (outstanding balance amount only), not including any loans already included in 1, or 2 ","","","",""],["","","","",""],["Full repayment is doubftul","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["Other loans for which full repayment is doubtful (do not include loans already included in 1, 2 or 3)","","","",""]]:e.questions[4].data=JSON.parse(e.questions[4].data);var d,l=document.getElementById("question_4");d=new Handsontable(l,{data:e.questions[4].data})}if(e.questions[5]=n(5),e.questions[5]){r.isEmpty(e.questions[5].data)?e.questions[5].data={1:[["","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["Funded Exposure to Top 20 ","","","",""],["Unfunded Exposure to Top 20 ","","","",""],["Single Largest Funded and Unfunded Exposure","","","",""]],2:[["","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["Regulatory NPL ratio per the central bank definition","","","",""]],3:[["","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["Tier 1, capital","","","",""],["Deductions","","","",""],["Tier 2, capital","","","",""],["Deductions","","","",""],["Total Capital"," -   "," -   "," -   "," -   "],["Total Risk Weighted Assets","","","",""],["Tier 1 ratio (%)","","","",""],["Total CAR ratio (%)","","","",""],["Basis of calculation (Basel I, Basel II, local standards)","","","",""]],4:[["","__/__/20__","12/31/2015","12/31/2014","12/31/2013"],["A. Total On-balance sheet FX Assets ","","","",""],["B. Total Off-balance sheet FX Assets (e.g. FX forward purchases)","","","",""],["Total Gross FX Long Position (A+B)"," -   "," -   "," -   "," -   "],["C. Total On-balance sheet FX Liabilities","","","",""],["D. Total Off-balance sheet FX Liabilities (e.g. FX forward sales)","","","",""],["Total Gross FX Short Position (C+D)"," -   "," -   "," -   "," -   "],["Net Open Position: On-Balance (A-C)"," -   "," -   "," -   "," -   "],["Net Open Position: On and Off-Balance ((A+B)-(C+D))"," -   "," -   "," -   "," -   "]]}:e.questions[5].data=JSON.parse(e.questions[5].data);var _,p=document.getElementById("question_5_1");_=new Handsontable(p,{data:e.questions[5].data[1]});var m,f=document.getElementById("question_5_2");m=new Handsontable(f,{data:e.questions[5].data[2]});var q,h=document.getElementById("question_5_3");q=new Handsontable(h,{data:e.questions[5].data[3]});var y,g=document.getElementById("question_5_4");y=new Handsontable(g,{data:e.questions[5].data[4]})}})}_(),e.users=[],e.storeAssign=function(){var t=[];angular.forEach(e.questions,function(e,n){e&&e.check&&t.push(e.id)}),d.StoreAssign({data:t,users:function(){var t=[];return angular.forEach(e.users,function(e,n){t.push({email:e.text})}),t}()},s.company_id,s.form_id).then(function(e){e.success?o.pop("success","Success!",""):angular.forEach(e.error,function(e){angular.forEach(e,function(e){o.pop("error","",e)})})})},e.assignToBcp=function(){var t=[];angular.forEach(e.questions,function(e,n){e.check&&t.push(e.id)}),d.StoreQuestionsToBcp(s.company_id,s.form_id,t).then(function(e){e.success&&o.pop("success","Success!","")})},e.selected_question={},e.getQuestionUsers=function(t){e.tmp_question_id=t,c.Users(t).then(function(t){e.selected_question.users=t.data})},e.unassignUser=function(t){c.Detach(e.tmp_question_id,t).then(function(t){t.success&&(o.pop("success","Success!",""),e.getQuestionUsers(e.tmp_question_id))})},e.visibleReplyForm=!1;var p=angular.element(document.querySelector("#global_add_comments_form"));e.showReplyForm=function(t,n){console.log(t,n),e.temp_comment_id=t,e.temp_comment_index=n;var s=angular.element(document.querySelector("#tmp_add_comments_form"+t));s.append(p),e.visibleReplyForm=!e.visibleReplyForm},e.comments=[],e.getAllComments=function(t){e.tmp_question_id=t,l.GetToQuestion(t).then(function(t){e.comments=t})},e.new_comment="",e.comment_tmp_reply="",e.storeComment=function(t,n){var s={comment:e.new_comment,question_id:e.tmp_question_id};"undefined"!=typeof t&&(s.comment=e.comment_tmp_reply,s.reply=1,s.reply_to=t),l.Store(s).then(function(t){t.success?(o.pop("success","Success!",""),e.new_comment="","undefined"==typeof n&&e.getAllComments(e.tmp_question_id),e.visibleReplyForm=!1,e.comment_tmp_reply=""):angular.forEach(t.error,function(e){angular.forEach(e,function(e){o.pop("error","",e)})})})},e.approveQuestion=function(e){c.Approve(e).then(function(e){e&&(o.pop("success","Success!",""),t.reload())})},e.disapproveQuestion=function(e){c.Disapprove(e).then(function(e){e&&(o.pop("success","Success!",""),t.reload())})}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm1zL0Zvcm1PbmVDdHJsLmpzIl0sIm5hbWVzIjpbImFuZ3VsYXIiLCJtb2R1bGUiLCJjb250cm9sbGVyIiwiJHNjb3BlIiwiJHN0YXRlIiwiJHJvb3RTY29wZSIsIiRzdGF0ZVBhcmFtcyIsInRvYXN0ZXIiLCJGb3JtU2VydmljZSIsIiRmaWx0ZXIiLCIkaHR0cCIsInVuZGVyc2NvcmUiLCJRdWVzdGlvblNlcnZpY2UiLCJVc2VyU2VydmljZSIsIkNvbW1lbnRTZXJ2aWNlIiwiZ2V0UXVlc3Rpb25zIiwiU2hvdyIsImZvcm1faWQiLCJ0aGVuIiwicmVzcG9uc2UiLCJnZXRRdWVzdGlvbkJ5UG9zaXRpb24iLCJwb3NpdGlvbiIsInF1ZXN0aW9uIiwiZmluZCIsImRhdGEiLCJxdWVzdGlvbnMiLCJpdGVtIiwiY2hlY2siLCJxX2RhdGEiLCJzYXZlIiwiaWQiLCJVcGRhdGUiLCJKU09OIiwic3RyaW5naWZ5IiwicG9wIiwiaXNFbXB0eSIsInBhcnNlIiwicTFfaG90IiwicTFfY29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIkhhbmRzb250YWJsZSIsImNlbGxzIiwiciIsImMiLCJjZWxsUHJvcGVydGllcyIsInR5cGUiLCJzb3VyY2UiLCJjaGVja18xIiwiY2hlY2tfMiIsImNoZWNrXzMiLCJjaGVja180IiwicTNfaG90IiwicTNfY29udGFpbmVyIiwicTRfaG90IiwicTRfY29udGFpbmVyIiwiMSIsIjIiLCIzIiwiNCIsInE1XzFfaG90IiwicTVfMV9jb250YWluZXIiLCJxNV8yX2hvdCIsInE1XzJfY29udGFpbmVyIiwicTVfM19ob3QiLCJxNV8zX2NvbnRhaW5lciIsInE1XzRfaG90IiwicTVfNF9jb250YWluZXIiLCJ1c2VycyIsInN0b3JlQXNzaWduIiwiYXJyIiwiZm9yRWFjaCIsInYiLCJrIiwicHVzaCIsIlN0b3JlQXNzaWduIiwiZW1haWwiLCJ0ZXh0IiwiY29tcGFueV9pZCIsInN1Y2Nlc3MiLCJlcnJvciIsIm1lc3NhZ2UiLCJhc3NpZ25Ub0JjcCIsIlN0b3JlUXVlc3Rpb25zVG9CY3AiLCJzZWxlY3RlZF9xdWVzdGlvbiIsImdldFF1ZXN0aW9uVXNlcnMiLCJ0bXBfcXVlc3Rpb25faWQiLCJVc2VycyIsInVuYXNzaWduVXNlciIsIkRldGFjaCIsInZpc2libGVSZXBseUZvcm0iLCJnbG9iYWxfZm9ybSIsImVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwic2hvd1JlcGx5Rm9ybSIsImluZGV4IiwiY29uc29sZSIsImxvZyIsInRlbXBfY29tbWVudF9pZCIsInRlbXBfY29tbWVudF9pbmRleCIsInRtcF9mb3JtIiwiYXBwZW5kIiwiY29tbWVudHMiLCJnZXRBbGxDb21tZW50cyIsIkdldFRvUXVlc3Rpb24iLCJyZXMiLCJuZXdfY29tbWVudCIsImNvbW1lbnRfdG1wX3JlcGx5Iiwic3RvcmVDb21tZW50IiwicmVwbHlfdG8iLCJjb21tZW50IiwicXVlc3Rpb25faWQiLCJyZXBseSIsIlN0b3JlIiwiYXBwcm92ZVF1ZXN0aW9uIiwiQXBwcm92ZSIsInJlbG9hZCIsImRpc2FwcHJvdmVRdWVzdGlvbiIsIkRpc2FwcHJvdmUiXSwibWFwcGluZ3MiOiJBQUFBLFlBQ0FBLFNBQVFDLE9BQU8sVUFBVUMsV0FBVyxlQUFnQixTQUFVLFNBQVUsYUFBYyxlQUFnQixVQUFXLGNBQWUsVUFBVyxRQUFTLGFBQWMsa0JBQW1CLGNBQWUsaUJBQW1CLFNBQVNDLEVBQVFDLEVBQVFDLEVBQVlDLEVBQWNDLEVBQVNDLEVBQWFDLEVBQVNDLEVBQU9DLEVBQVlDLEVBQWlCQyxFQUFhQyxHQUt0VixRQUFTQyxLQUNMUCxFQUFZUSxLQUFLVixFQUFhVyxTQUFTQyxLQUFLLFNBQVVDLEdBRWxELFFBQVNDLEdBQXNCQyxHQUMzQixHQUFJQyxHQUFXWCxFQUFXWSxLQUFLSixFQUFTSyxLQUFLQyxVQUFXLFNBQVVDLEdBQzlELE1BQU9BLEdBQUtMLFVBQVlBLEdBSzVCLE9BSHNCLG1CQUFaQyxLQUNOQSxFQUFTSyxPQUFRLEdBRWRMLEVBcUJYLEdBbEJB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UyxFQUFPLFNBQVVDLEdBQzdCMUUsRUFBUTJCLElBQUksUUFBUyxHQUFJK0MsVUFhN0M5RSxFQUFPK0csZ0JBQWtCLFNBQVNwRixHQUM5QmxCLEVBQWdCdUcsUUFBUXJGLEdBQUlaLEtBQUssU0FBVXVGLEdBQ3BDQSxJQUNDbEcsRUFBUTJCLElBQUksVUFBVyxXQUFZLElBQ25DOUIsRUFBT2dILGFBTW5CakgsRUFBT2tILG1CQUFxQixTQUFTdkYsR0FDakNsQixFQUFnQjBHLFdBQVd4RixHQUFJWixLQUFLLFNBQVV1RixHQUN2Q0EsSUFDQ2xHLEVBQVEyQixJQUFJLFVBQVcsV0FBWSxJQUNuQzlCLEVBQU9nSCIsImZpbGUiOiJmb3Jtcy9Gb3JtT25lQ3RybC5qcyIsInNvdXJjZXNDb250ZW50IjpbIid1c2Ugc3RyaWN0JztcbmFuZ3VsYXIubW9kdWxlKCdCZmNBcHAnKS5jb250cm9sbGVyKCdGb3JtT25lQ3RybCcsIFsnJHNjb3BlJywgJyRzdGF0ZScsICckcm9vdFNjb3BlJywgJyRzdGF0ZVBhcmFtcycsICd0b2FzdGVyJywgJ0Zvcm1TZXJ2aWNlJywgJyRmaWx0ZXInLCAnJGh0dHAnLCAndW5kZXJzY29yZScsICdRdWVzdGlvblNlcnZpY2UnLCAnVXNlclNlcnZpY2UnLCAnQ29tbWVudFNlcnZpY2UnLCAgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRyb290U2NvcGUsICRzdGF0ZVBhcmFtcywgdG9hc3RlciwgRm9ybVNlcnZpY2UsICRmaWx0ZXIsICRodHRwLCB1bmRlcnNjb3JlLCBRdWVzdGlvblNlcnZpY2UsIFVzZXJTZXJ2aWNlLCBDb21tZW50U2VydmljZSkge1xuXG4gICAgLypcbiAgICAgVG9kbyAtIEZyb20gMSBmdW5jdGlvbmFsXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0UXVlc3Rpb25zKCkge1xuICAgICAgICBGb3JtU2VydmljZS5TaG93KCRzdGF0ZVBhcmFtcy5mb3JtX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRRdWVzdGlvbkJ5UG9zaXRpb24ocG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSB1bmRlcnNjb3JlLmZpbmQocmVzcG9uc2UuZGF0YS5xdWVzdGlvbnMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnBvc2l0aW9uID09IHBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBxdWVzdGlvbiAhPSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICAgICAgICAgIHF1ZXN0aW9uLmNoZWNrID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHF1ZXN0aW9uO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkc2NvcGUucV9kYXRhID0gW107XG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgU2F2ZSBxdWVzdGlvblxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIFF1ZXN0aW9uU2VydmljZS5VcGRhdGUoJHNjb3BlLnF1ZXN0aW9uc1tpZF0uaWQsIEpTT04uc3RyaW5naWZ5KCRzY29wZS5xdWVzdGlvbnNbaWRdLmRhdGEpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsIFwiU3VjY2VzcyFcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb25zID0gW107XG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgUXVlc3Rpb24gMVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb25zWzFdID0gZ2V0UXVlc3Rpb25CeVBvc2l0aW9uKDEpO1xuXG4gICAgICAgICAgICBpZigkc2NvcGUucXVlc3Rpb25zWzFdKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVuZGVyc2NvcmUuaXNFbXB0eSgkc2NvcGUucXVlc3Rpb25zWzFdLmRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbnNbMV0uZGF0YSA9IFtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIFsnQmFuayBuYW1lJywgJyddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydDdXJyZW5jeScsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnQ3VycmVudCB1bml0JywgJyddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydCYW5rIG9ubHkgb2YgY29uc29saWRhdGVkJywgJyddXG4gICAgICAgICAgICAgICAgICAgIF07XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnF1ZXN0aW9uc1sxXS5kYXRhID0gSlNPTi5wYXJzZSgkc2NvcGUucXVlc3Rpb25zWzFdLmRhdGEpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIHZhciBxMV9jb250YWluZXIgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncXVlc3Rpb25fMScpLFxuICAgICAgICAgICAgICAgICAgICBxMV9ob3Q7XG5cbiAgICAgICAgICAgICAgICBxMV9ob3QgPSBuZXcgSGFuZHNvbnRhYmxlKHExX2NvbnRhaW5lciwge1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkc2NvcGUucXVlc3Rpb25zWzFdLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgIGNlbGxzOiBmdW5jdGlvbiAociwgYykge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNlbGxQcm9wZXJ0aWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChyID09PSAxICYmIGMgPT09IDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkcm9wZG93bicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogWydVbml0JywgJ3Rob3VzYW5kJywgJ21pbGxpb24nXVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbGxQcm9wZXJ0aWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKChyID09PSAyICYmIGMgPT09IDEpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkcm9wZG93bicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNvdXJjZTogWydCYW5rIE9ubHknLCAnQ29uc29saWRhdGVkJ11cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjZWxsUHJvcGVydGllcztcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgRW5kIFF1ZXN0aW9uIDFcbiAgICAgICAgICAgICAqL1xuXG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgIFF1ZXN0aW9uIDJcbiAgICAgICAgICAgICAqL1xuICAgICAgICAgICAgJHNjb3BlLnF1ZXN0aW9uc1syXSA9IGdldFF1ZXN0aW9uQnlQb3NpdGlvbigyKTtcblxuICAgICAgICAgICAgaWYoJHNjb3BlLnF1ZXN0aW9uc1syXSkge1xuICAgICAgICAgICAgICAgIGlmICh1bmRlcnNjb3JlLmlzRW1wdHkoJHNjb3BlLnF1ZXN0aW9uc1syXS5kYXRhKSkge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucXVlc3Rpb25zWzJdLmRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja18xOiAnJyxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNoZWNrXzI6ICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgY2hlY2tfMzogJycsXG4gICAgICAgICAgICAgICAgICAgICAgICBjaGVja180OiAnJ1xuICAgICAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbnNbMl0uZGF0YSA9IEpTT04ucGFyc2UoJHNjb3BlLnF1ZXN0aW9uc1syXS5kYXRhKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgIEVuZCBRdWVzdGlvbiAyXG4gICAgICAgICAgICAgKi9cblxuXG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgUXVlc3Rpb24gM1xuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb25zWzNdID0gZ2V0UXVlc3Rpb25CeVBvc2l0aW9uKDMpO1xuXG4gICAgICAgICAgICBpZigkc2NvcGUucXVlc3Rpb25zWzNdKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVuZGVyc2NvcmUuaXNFbXB0eSgkc2NvcGUucXVlc3Rpb25zWzNdLmRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbnNbM10uZGF0YSA9IChbXG4gICAgICAgICAgICAgICAgICAgICAgICBbJycsICdfXy9fXy8yMF9fJywgJzEyLzMxLzIwMTUnLCAnMTIvMzEvMjAxNCcsICcxMi8zMS8yMDEzJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ1ByaW5jaXBhbCBvciBpbnRlcmVzdCBpcyA5MCBkYXlzIG9yIG1vcmUgcGFzdCBkdWUnLCAnJywgJycsICcnLCAnJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ1RoZSBiYW5rIGhhcyBwbGFjZWQgdGhlIGV4cG9zdXJlIGluIG5vbi1hY2N1cmFsIHN0YXR1cycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnUmVzdHJ1Y3R1cmVkIHdpdGhpbiB0aGUgbGFzdCAxMiBtb250aHMnLCAnJywgJycsICcnLCAnJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0Z1bGwgcmVwYXltZW50IGlzIGRvdWJ0ZnVsIGV2ZW4gaWYgY3VycmVudCBvciBsZXNzIHRoYW4gOTAgZGF5cyBwYXN0IGR1ZScsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnVG90YWwgTlBMJywgJycsICcnLCAnJywgJyddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWycnLCAnJywgJycsICcnLCAnJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0dyb3NzIGxvYW5zJywgJycsICcnLCAnJywgJyddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWydBREIgTlBMIHJhdGlvJywgJycsICcnLCAnJywgJyddLFxuICAgICAgICAgICAgICAgICAgICAgICAgWycnLCAnJywgJycsICcnLCAnJ10sXG4gICAgICAgICAgICAgICAgICAgICAgICBbJ0FEQiBOUEwgcmF0aW8gY292ZW5hbnQnLCAnJywgJycsICcnLCAnJ10sXG4gICAgICAgICAgICAgICAgICAgIF0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbnNbM10uZGF0YSA9IEpTT04ucGFyc2UoJHNjb3BlLnF1ZXN0aW9uc1szXS5kYXRhKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgcTNfY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1ZXN0aW9uXzMnKSxcbiAgICAgICAgICAgICAgICAgICAgcTNfaG90O1xuXG4gICAgICAgICAgICAgICAgcTNfaG90ID0gbmV3IEhhbmRzb250YWJsZShxM19jb250YWluZXIsIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJHNjb3BlLnF1ZXN0aW9uc1szXS5kYXRhXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgIEVuZCBRdWVzdGlvbiAzXG4gICAgICAgICAgICAgKi9cblxuICAgICAgICAgICAgLypcbiAgICAgICAgICAgICBRdWVzdGlvbiA0XG4gICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbnNbNF0gPSBnZXRRdWVzdGlvbkJ5UG9zaXRpb24oNCk7XG5cbiAgICAgICAgICAgIGlmKCRzY29wZS5xdWVzdGlvbnNbNF0pIHtcbiAgICAgICAgICAgICAgICBpZiAodW5kZXJzY29yZS5pc0VtcHR5KCRzY29wZS5xdWVzdGlvbnNbNF0uZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnF1ZXN0aW9uc1s0XS5kYXRhID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAgW1wiTm9uIGFjY3VyYWwgbG9hbnNcIiwgXCJfX1xcL19fXFwvMjBfX1wiLCBcIjEyXFwvMzFcXC8yMDE1XCIsIFwiMTJcXC8zMVxcLzIwMTRcIiwgXCIxMlxcLzMxXFwvMjAxM1wiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcIk5vbi1hY2NydWFsIGxvYW5zIHRoYXQgYXJlIGN1cnJlbnQgb3IgPDkwIGRheXMgcGFzdCBkdWVcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCJOb24tYWNjcnVhbCBsb2FucyB0aGF0IGFyZSA+OTAgZGF5c1wiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcIlRvdGFsIE5vbi1hY2NydWFsIExvYW5zIFwiLCBcIiAtICAgXCIsIFwiIC0gICBcIiwgXCIgLSAgIFwiLCBcIiAtICAgXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgW1wiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgW1wiTm9uIGFjY3VyYWwgbG9hbnNcIiwgXCJfX1xcL19fXFwvMjBfX1wiLCBcIjEyXFwvMzFcXC8yMDE1XCIsIFwiMTJcXC8zMVxcLzIwMTRcIiwgXCIxMlxcLzMxXFwvMjAxM1wiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcIk5vbi1hY2NydWFsIGxvYW5zIHRoYXQgYXJlIGN1cnJlbnQgb3IgPDkwIGRheXMgcGFzdCBkdWVcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCJOb24tYWNjcnVhbCBsb2FucyB0aGF0IGFyZSA+OTAgZGF5c1wiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFtcIlRvdGFsIE5vbi1hY2NydWFsIExvYW5zIFwiLCBcIiAtICAgXCIsIFwiIC0gICBcIiwgXCIgLSAgIFwiLCBcIiAtICAgXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgW1wiXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgW1wiUmVzdHJ1Y3R1cmVkIGxvYW5zXCIsIFwiX19cXC9fX1xcLzIwX19cIiwgXCIxMlxcLzMxXFwvMjAxNVwiLCBcIjEyXFwvMzFcXC8yMDE0XCIsIFwiMTJcXC8zMVxcLzIwMTNcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCJMb2FucyByZXN0cnVjdHVyZWQgd2l0aGluIHRoZSBwYXN0IDEyIG1vbnRocyAob3V0c3RhbmRpbmcgYmFsYW5jZSBhbW91bnQgb25seSlcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCJMb2FucyByZXN0cnVjdHVyZWQgd2l0aGluIHRoZSBwYXN0IDEyIG1vbnRocyAob3V0c3RhbmRpbmcgYmFsYW5jZSBhbW91bnQgb25seSksIG5vdCBpbmNsdWRpbmcgYW55IGxvYW5zIGFscmVhZHkgaW5jbHVkZWQgaW4gMSwgb3IgMiBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCJcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICBbXCJGdWxsIHJlcGF5bWVudCBpcyBkb3ViZnR1bFwiLCBcIl9fXFwvX19cXC8yMF9fXCIsIFwiMTJcXC8zMVxcLzIwMTVcIiwgXCIxMlxcLzMxXFwvMjAxNFwiLCBcIjEyXFwvMzFcXC8yMDEzXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgW1wiT3RoZXIgbG9hbnMgZm9yIHdoaWNoIGZ1bGwgcmVwYXltZW50IGlzIGRvdWJ0ZnVsIChkbyBub3QgaW5jbHVkZSBsb2FucyBhbHJlYWR5IGluY2x1ZGVkIGluIDEsIDIgb3IgMylcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl1cbiAgICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucXVlc3Rpb25zWzRdLmRhdGEgPSBKU09OLnBhcnNlKCRzY29wZS5xdWVzdGlvbnNbNF0uZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHE0X2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWVzdGlvbl80JyksXG4gICAgICAgICAgICAgICAgICAgIHE0X2hvdDtcblxuICAgICAgICAgICAgICAgIHE0X2hvdCA9IG5ldyBIYW5kc29udGFibGUocTRfY29udGFpbmVyLCB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRzY29wZS5xdWVzdGlvbnNbNF0uZGF0YSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgRW5kIFF1ZXN0aW9uIDRcbiAgICAgICAgICAgICAqL1xuXG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgUXVlc3Rpb24gNVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb25zWzVdID0gZ2V0UXVlc3Rpb25CeVBvc2l0aW9uKDUpO1xuXG4gICAgICAgICAgICBpZigkc2NvcGUucXVlc3Rpb25zWzVdKSB7XG4gICAgICAgICAgICAgICAgaWYgKHVuZGVyc2NvcmUuaXNFbXB0eSgkc2NvcGUucXVlc3Rpb25zWzVdLmRhdGEpKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbnNbNV0uZGF0YSA9IHtcbiAgICAgICAgICAgICAgICAgICAgICAgIDE6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJcIiwgXCJfX1xcL19fXFwvMjBfX1wiLCBcIjEyXFwvMzFcXC8yMDE1XCIsIFwiMTJcXC8zMVxcLzIwMTRcIiwgXCIxMlxcLzMxXFwvMjAxM1wiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJGdW5kZWQgRXhwb3N1cmUgdG8gVG9wIDIwIFwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJVbmZ1bmRlZCBFeHBvc3VyZSB0byBUb3AgMjAgXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcIlNpbmdsZSBMYXJnZXN0IEZ1bmRlZCBhbmQgVW5mdW5kZWQgRXhwb3N1cmVcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl1cbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgICAgICAgICAyOiBbXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiXCIsIFwiX19cXC9fX1xcLzIwX19cIiwgXCIxMlxcLzMxXFwvMjAxNVwiLCBcIjEyXFwvMzFcXC8yMDE0XCIsIFwiMTJcXC8zMVxcLzIwMTNcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiUmVndWxhdG9yeSBOUEwgcmF0aW8gcGVyIHRoZSBjZW50cmFsIGJhbmsgZGVmaW5pdGlvblwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXVxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIDM6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJcIiwgXCJfX1xcL19fXFwvMjBfX1wiLCBcIjEyXFwvMzFcXC8yMDE1XCIsIFwiMTJcXC8zMVxcLzIwMTRcIiwgXCIxMlxcLzMxXFwvMjAxM1wiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJUaWVyIDEsIGNhcGl0YWxcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiRGVkdWN0aW9uc1wiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJUaWVyIDIsIGNhcGl0YWxcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiRGVkdWN0aW9uc1wiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJUb3RhbCBDYXBpdGFsXCIsIFwiIC0gICBcIiwgXCIgLSAgIFwiLCBcIiAtICAgXCIsIFwiIC0gICBcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiVG90YWwgUmlzayBXZWlnaHRlZCBBc3NldHNcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiVGllciAxIHJhdGlvICglKVwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJUb3RhbCBDQVIgcmF0aW8gKCUpXCIsIFwiXCIsIFwiXCIsIFwiXCIsIFwiXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcIkJhc2lzIG9mIGNhbGN1bGF0aW9uIChCYXNlbCBJLCBCYXNlbCBJSSwgbG9jYWwgc3RhbmRhcmRzKVwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXVxuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIDQ6IFtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJcIiwgXCJfX1xcL19fXFwvMjBfX1wiLCBcIjEyXFwvMzFcXC8yMDE1XCIsIFwiMTJcXC8zMVxcLzIwMTRcIiwgXCIxMlxcLzMxXFwvMjAxM1wiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJBLiBUb3RhbCBPbi1iYWxhbmNlIHNoZWV0IEZYIEFzc2V0cyBcIiwgXCJcIiwgXCJcIiwgXCJcIiwgXCJcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiQi4gVG90YWwgT2ZmLWJhbGFuY2Ugc2hlZXQgRlggQXNzZXRzIChlLmcuIEZYIGZvcndhcmQgcHVyY2hhc2VzKVwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJUb3RhbCBHcm9zcyBGWCBMb25nIFBvc2l0aW9uIChBK0IpXCIsIFwiIC0gICBcIiwgXCIgLSAgIFwiLCBcIiAtICAgXCIsIFwiIC0gICBcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiQy4gVG90YWwgT24tYmFsYW5jZSBzaGVldCBGWCBMaWFiaWxpdGllc1wiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJELiBUb3RhbCBPZmYtYmFsYW5jZSBzaGVldCBGWCBMaWFiaWxpdGllcyAoZS5nLiBGWCBmb3J3YXJkIHNhbGVzKVwiLCBcIlwiLCBcIlwiLCBcIlwiLCBcIlwiXSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBbXCJUb3RhbCBHcm9zcyBGWCBTaG9ydCBQb3NpdGlvbiAoQytEKVwiLCBcIiAtICAgXCIsIFwiIC0gICBcIiwgXCIgLSAgIFwiLCBcIiAtICAgXCJdLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFtcIk5ldCBPcGVuIFBvc2l0aW9uOiBPbi1CYWxhbmNlIChBLUMpXCIsIFwiIC0gICBcIiwgXCIgLSAgIFwiLCBcIiAtICAgXCIsIFwiIC0gICBcIl0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgW1wiTmV0IE9wZW4gUG9zaXRpb246IE9uIGFuZCBPZmYtQmFsYW5jZSAoKEErQiktKEMrRCkpXCIsIFwiIC0gICBcIiwgXCIgLSAgIFwiLCBcIiAtICAgXCIsIFwiIC0gICBcIl1cbiAgICAgICAgICAgICAgICAgICAgICAgIF1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5xdWVzdGlvbnNbNV0uZGF0YSA9IEpTT04ucGFyc2UoJHNjb3BlLnF1ZXN0aW9uc1s1XS5kYXRhKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAvLyAxIHRhYmxlXG4gICAgICAgICAgICAgICAgdmFyIHE1XzFfY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1ZXN0aW9uXzVfMScpLFxuICAgICAgICAgICAgICAgICAgICBxNV8xX2hvdDtcblxuICAgICAgICAgICAgICAgIHE1XzFfaG90ID0gbmV3IEhhbmRzb250YWJsZShxNV8xX2NvbnRhaW5lciwge1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkc2NvcGUucXVlc3Rpb25zWzVdLmRhdGFbMV0sXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyAyIHRhYmxlXG4gICAgICAgICAgICAgICAgdmFyIHE1XzJfY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1ZXN0aW9uXzVfMicpLFxuICAgICAgICAgICAgICAgICAgICBxNV8yX2hvdDtcblxuICAgICAgICAgICAgICAgIHE1XzJfaG90ID0gbmV3IEhhbmRzb250YWJsZShxNV8yX2NvbnRhaW5lciwge1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkc2NvcGUucXVlc3Rpb25zWzVdLmRhdGFbMl0sXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyAzIHRhYmxlXG4gICAgICAgICAgICAgICAgdmFyIHE1XzNfY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3F1ZXN0aW9uXzVfMycpLFxuICAgICAgICAgICAgICAgICAgICBxNV8zX2hvdDtcblxuICAgICAgICAgICAgICAgIHE1XzNfaG90ID0gbmV3IEhhbmRzb250YWJsZShxNV8zX2NvbnRhaW5lciwge1xuICAgICAgICAgICAgICAgICAgICBkYXRhOiAkc2NvcGUucXVlc3Rpb25zWzVdLmRhdGFbM10sXG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICAvLyA0ICB0YWJsZVxuICAgICAgICAgICAgICAgIHZhciBxNV80X2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWVzdGlvbl81XzQnKSxcbiAgICAgICAgICAgICAgICAgICAgcTVfNF9ob3Q7XG5cbiAgICAgICAgICAgICAgICBxNV80X2hvdCA9IG5ldyBIYW5kc29udGFibGUocTVfNF9jb250YWluZXIsIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YTogJHNjb3BlLnF1ZXN0aW9uc1s1XS5kYXRhWzRdLFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgICAgIEVuZCBRdWVzdGlvbiA1XG4gICAgICAgICAgICAgICAgICovXG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBnZXRRdWVzdGlvbnMoKTtcblxuXG4gICAgLypcbiAgICBBc3NpZ24gZnVuY3Rpb25hbFxuICAgICAqL1xuICAgICRzY29wZS51c2VycyA9IFtdO1xuICAgIC8qXG4gICAgIFRvZG8gLSBBc3NpZ24gcXVlc3Rpb25zIHRvIHVzZXIgKCsgY3JlYXRlIG5ldyB1c2VyKSByb2xlXG4gICAgICovXG4gICAgJHNjb3BlLnN0b3JlQXNzaWduID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJyID0gW107XG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUucXVlc3Rpb25zLCBmdW5jdGlvbiAodixrKSB7XG4gICAgICAgICAgICBpZih2KXtcbiAgICAgICAgICAgICAgICBpZih2LmNoZWNrKXtcbiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2godi5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBVc2VyU2VydmljZS5TdG9yZUFzc2lnbih7XG4gICAgICAgICAgICAnZGF0YScgOiBhcnIsXG4gICAgICAgICAgICAndXNlcnMnIDogKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUudXNlcnMsIGZ1bmN0aW9uICh2LGspIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdlbWFpbCcgOiB2LnRleHRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH0oKSlcbiAgICAgICAgfSwgJHN0YXRlUGFyYW1zLmNvbXBhbnlfaWQsICRzdGF0ZVBhcmFtcy5mb3JtX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2Vzcyl7XG4gICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCBcIlN1Y2Nlc3MhXCIsIFwiXCIpO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJlc3BvbnNlLmVycm9yLCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGVycm9yLCBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ2Vycm9yJywgXCJcIiwgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFxuICAgIC8qXG4gICAgVG9kbyAtIEFzc2lnbiBxdWVzdGlvbnMgdG8gQkNwIHJvbGVcbiAgICAgKi9cbiAgICAkc2NvcGUuYXNzaWduVG9CY3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcnIgPSBbXTtcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5xdWVzdGlvbnMsIGZ1bmN0aW9uICh2LGspIHtcbiAgICAgICAgICAgIGlmKHYuY2hlY2spe1xuICAgICAgICAgICAgICAgIGFyci5wdXNoKHYuaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgVXNlclNlcnZpY2UuU3RvcmVRdWVzdGlvbnNUb0JjcCgkc3RhdGVQYXJhbXMuY29tcGFueV9pZCwgJHN0YXRlUGFyYW1zLmZvcm1faWQsIGFycikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN1Y2Nlc3Mpe1xuICAgICAgICAgICAgICAgIHRvYXN0ZXIucG9wKCdzdWNjZXNzJywgXCJTdWNjZXNzIVwiLCBcIlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qXG4gICAgIEVORCBBc3NpZ24gZnVuY3Rpb25hbFxuICAgICAqL1xuXG5cbiAgICAvKlxuICAgICBVbmFzc2lnbiBmdW5jdGlvbmFsXG4gICAgICovXG5cbiAgICAvKlxuICAgICBUb2RvIC0gR2V0IHVzZXJzIHRvIHF1ZXN0aW9uc1xuICAgICAqL1xuICAgICRzY29wZS5zZWxlY3RlZF9xdWVzdGlvbiA9IHt9O1xuICAgICRzY29wZS5nZXRRdWVzdGlvblVzZXJzID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICRzY29wZS50bXBfcXVlc3Rpb25faWQgPSBpZDtcbiAgICAgICAgUXVlc3Rpb25TZXJ2aWNlLlVzZXJzKGlkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX3F1ZXN0aW9uLnVzZXJzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qXG4gICAgIFRvZG8gLSBVbmFzc2lnbiB1c2VyIGZyb20gcXVlc3Rpb25cbiAgICAgKi9cbiAgICAkc2NvcGUudW5hc3NpZ25Vc2VyID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIFF1ZXN0aW9uU2VydmljZS5EZXRhY2goJHNjb3BlLnRtcF9xdWVzdGlvbl9pZCwgaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZihyZXNwb25zZS5zdWNjZXNzKXtcbiAgICAgICAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsIFwiU3VjY2VzcyFcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldFF1ZXN0aW9uVXNlcnMoJHNjb3BlLnRtcF9xdWVzdGlvbl9pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKlxuICAgICBFTkQgVW5hc3NpZ24gZnVuY3Rpb25hbFxuICAgICAqL1xuXG4gICAgLypcbiAgICBUb2RvIC0gQ29tbWVudHMgZnVuY3Rpb25hbFxuICAgICAqL1xuXG4gICAgLy8gU2hvdyByZXBseSBmb3JtXG4gICAgJHNjb3BlLnZpc2libGVSZXBseUZvcm0gPSBmYWxzZTtcbiAgICB2YXIgZ2xvYmFsX2Zvcm0gPSBhbmd1bGFyLmVsZW1lbnQoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoICcjZ2xvYmFsX2FkZF9jb21tZW50c19mb3JtJykgKTtcbiAgICAkc2NvcGUuc2hvd1JlcGx5Rm9ybSA9IGZ1bmN0aW9uKGlkLCBpbmRleCl7XG4gICAgICAgIGNvbnNvbGUubG9nKGlkLCBpbmRleCk7XG4gICAgICAgICRzY29wZS50ZW1wX2NvbW1lbnRfaWQgPSBpZDtcbiAgICAgICAgJHNjb3BlLnRlbXBfY29tbWVudF9pbmRleCA9IGluZGV4O1xuICAgICAgICB2YXIgdG1wX2Zvcm0gPSBhbmd1bGFyLmVsZW1lbnQoIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoICcjdG1wX2FkZF9jb21tZW50c19mb3JtJytpZCkgKTtcbiAgICAgICAgdG1wX2Zvcm0uYXBwZW5kKGdsb2JhbF9mb3JtKTtcbiAgICAgICAgJHNjb3BlLnZpc2libGVSZXBseUZvcm0gPSAhJHNjb3BlLnZpc2libGVSZXBseUZvcm07XG4gICAgfTtcblxuICAgIC8vIEdldCBhbGwgY29tbWVudCB0byBxdWVzdGlvbnNcbiAgICAkc2NvcGUuY29tbWVudHMgPSBbXTtcbiAgICAkc2NvcGUuZ2V0QWxsQ29tbWVudHMgPSBmdW5jdGlvbiAoaWQpIHtcbiAgICAgICAgJHNjb3BlLnRtcF9xdWVzdGlvbl9pZCA9IGlkO1xuICAgICAgICBDb21tZW50U2VydmljZS5HZXRUb1F1ZXN0aW9uKGlkKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICRzY29wZS5jb21tZW50cyA9IHJlcztcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8vIFN0b3JlIG5ldyBjb21tZW50XG4gICAgJHNjb3BlLm5ld19jb21tZW50ID0gJyc7XG4gICAgJHNjb3BlLmNvbW1lbnRfdG1wX3JlcGx5ID0gJyc7XG4gICAgJHNjb3BlLnN0b3JlQ29tbWVudCA9IGZ1bmN0aW9uIChyZXBseV90bywgaW5kZXgpIHtcbiAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAnY29tbWVudCc6JHNjb3BlLm5ld19jb21tZW50LFxuICAgICAgICAgICAgJ3F1ZXN0aW9uX2lkJzokc2NvcGUudG1wX3F1ZXN0aW9uX2lkLFxuICAgICAgICB9O1xuICAgICAgICBpZih0eXBlb2YgcmVwbHlfdG8gIT0gJ3VuZGVmaW5lZCcpe1xuICAgICAgICAgICAgZGF0YS5jb21tZW50ID0gJHNjb3BlLmNvbW1lbnRfdG1wX3JlcGx5O1xuICAgICAgICAgICAgZGF0YS5yZXBseSA9IDE7XG4gICAgICAgICAgICBkYXRhLnJlcGx5X3RvID0gcmVwbHlfdG87XG4gICAgICAgIH07XG4gICAgICAgIENvbW1lbnRTZXJ2aWNlLlN0b3JlKGRhdGEpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgaWYocmVzLnN1Y2Nlc3Mpe1xuICAgICAgICAgICAgICAgIHRvYXN0ZXIucG9wKCdzdWNjZXNzJywgXCJTdWNjZXNzIVwiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUubmV3X2NvbW1lbnQgPSAnJztcbiAgICAgICAgICAgICAgICAvLyBpZih0eXBlb2YgaW5kZXggIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAvLyAgICAgJHNjb3BlLmNvbW1lbnRzW2luZGV4XS50bXBfcmVwbHkgPSAnJztcbiAgICAgICAgICAgICAgICAvLyB9O1xuICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBpbmRleCA9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUuZ2V0QWxsQ29tbWVudHMoJHNjb3BlLnRtcF9xdWVzdGlvbl9pZCk7XG4gICAgICAgICAgICAgICAgfTtcblxuICAgICAgICAgICAgICAgIC8vIHJlbG9hZCBhbGwgY29tbWVudHNcbiAgICAgICAgICAgICAgICAkc2NvcGUudmlzaWJsZVJlcGx5Rm9ybSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIC8vICRzY29wZS5nZXRBbGxDb21tZW50cygkc2NvcGUudG1wX3F1ZXN0aW9uX2lkKTtcbiAgICAgICAgICAgICAgICAkc2NvcGUuY29tbWVudF90bXBfcmVwbHkgPSAnJztcbiAgICAgICAgICAgIH1lbHNle1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChyZXMuZXJyb3IsIGZ1bmN0aW9uIChlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICBhbmd1bGFyLmZvckVhY2goZXJyb3IsIGZ1bmN0aW9uIChtZXNzYWdlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB0b2FzdGVyLnBvcCgnZXJyb3InLCBcIlwiLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgLypcbiAgICAgRU5EIENvbW1lbnRzIGZ1bmN0aW9uYWxcbiAgICAgKi9cblxuICAgIC8qXG4gICAgVG9kbyAtIEFwcHJvdmUgLyBEaXNhcHByb3ZlIGZ1bmN0aW9uYWxcbiAgICAgKi9cbiAgICAkc2NvcGUuYXBwcm92ZVF1ZXN0aW9uID0gZnVuY3Rpb24oaWQpe1xuICAgICAgICBRdWVzdGlvblNlcnZpY2UuQXBwcm92ZShpZCkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICBpZihyZXMpe1xuICAgICAgICAgICAgICAgIHRvYXN0ZXIucG9wKCdzdWNjZXNzJywgXCJTdWNjZXNzIVwiLCBcIlwiKTtcbiAgICAgICAgICAgICAgICAkc3RhdGUucmVsb2FkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cblxuICAgICRzY29wZS5kaXNhcHByb3ZlUXVlc3Rpb24gPSBmdW5jdGlvbihpZCl7XG4gICAgICAgIFF1ZXN0aW9uU2VydmljZS5EaXNhcHByb3ZlKGlkKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIGlmKHJlcyl7XG4gICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCBcIlN1Y2Nlc3MhXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgICRzdGF0ZS5yZWxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKlxuICAgIEVORCBBcHByb3ZlIC8gRGlzYXBwcm92ZSBmdW5jdGlvbmFsXG4gICAgICovXG5cbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
