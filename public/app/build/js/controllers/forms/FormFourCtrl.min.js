"use strict";angular.module("BfcApp").controller("FormFourCtrl",["$scope","$state","$stateParams","toaster","FormService","$filter","$http","underscore","QuestionService","UserService","CommentService",function(e,n,t,o,s,c,u,i,r,a,p){function m(){s.Show(t.form_id).then(function(n){function t(e){var t=i.find(n.data.questions,function(n){return n.position==e});return"undefined"!=typeof t&&(t.check=!0),t}if(e.questions=[],e.save=function(n){r.Update(e.questions[n].id,JSON.stringify(e.questions[n].data)).then(function(e){o.pop("success","Success!","")})},e.questions[1]=t(1),e.questions[1]){i.isEmpty(e.questions[1].data)?e.questions[1].data=[["Indicator [prudential acronym]","Requirement","Actual value 1","Complied (Y/N)","If not complied, please provide details 2"],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""],["","","","","",""]]:e.questions[1].data=JSON.parse(e.questions[1].data);var s,c=document.getElementById("question_1");s=new Handsontable(c,{data:e.questions[1].data,columns:[{},{},{},{type:"dropdown",source:["yes","no"]},{}],cells:function(e,n){var t;if(0===e&&3===n)return t={type:"text"}}})}})}m(),e.users=[],e.storeAssign=function(){var n=[];angular.forEach(e.questions,function(e,t){e&&e.check&&n.push(e.id)}),a.StoreAssign({data:n,users:function(){var n=[];return angular.forEach(e.users,function(e,t){n.push({email:e.text})}),n}()},t.company_id,t.form_id).then(function(e){o.pop("success","Success!","")})},e.assignToBcp=function(){var n=[];angular.forEach(e.questions,function(e,t){e.check&&n.push(e.id)}),a.StoreQuestionsToBcp(t.company_id,t.form_id,n).then(function(e){o.pop("success","Success!","")})},e.users=[],e.storeAssign=function(){var n=[];angular.forEach(e.questions,function(e,t){e&&e.check&&n.push(e.id)}),a.StoreAssign({data:n,users:function(){var n=[];return angular.forEach(e.users,function(e,t){n.push({email:e.text})}),n}()},t.company_id,t.form_id).then(function(e){e.success?o.pop("success","Success!",""):angular.forEach(e.error,function(e){angular.forEach(e,function(e){o.pop("error","",e)})})})},e.assignToBcp=function(){var n=[];angular.forEach(e.questions,function(e,t){e.check&&n.push(e.id)}),a.StoreQuestionsToBcp(t.company_id,t.form_id,n).then(function(e){e.success&&o.pop("success","Success!","")})},e.selected_question={},e.getQuestionUsers=function(n){e.tmp_question_id=n,r.Users(n).then(function(n){e.selected_question.users=n.data})},e.unassignUser=function(n){r.Detach(e.tmp_question_id,n).then(function(n){n.success&&(o.pop("success","Success!",""),e.getQuestionUsers(e.tmp_question_id))})},e.visibleReplyForm=!1;var f=angular.element(document.querySelector("#global_add_comments_form"));e.showReplyForm=function(n,t){console.log(n,t),e.temp_comment_id=n,e.temp_comment_index=t;var o=angular.element(document.querySelector("#tmp_add_comments_form"+n));o.append(f),e.visibleReplyForm=!e.visibleReplyForm},e.comments=[],e.getAllComments=function(n){e.tmp_question_id=n,p.GetToQuestion(n).then(function(n){e.comments=n})},e.new_comment="",e.comment_tmp_reply="",e.storeComment=function(n,t){var s={comment:e.new_comment,question_id:e.tmp_question_id};"undefined"!=typeof n&&(s.comment=e.comment_tmp_reply,s.reply=1,s.reply_to=n),p.Store(s).then(function(n){n.success?(o.pop("success","Success!",""),e.new_comment="","undefined"==typeof t&&e.getAllComments(e.tmp_question_id),e.visibleReplyForm=!1,e.comment_tmp_reply=""):angular.forEach(n.error,function(e){angular.forEach(e,function(e){o.pop("error","",e)})})})},e.approveQuestion=function(e){r.Approve(e).then(function(e){e&&(o.pop("success","Success!",""),n.reload())})},e.disapproveQuestion=function(e){r.Disapprove(e).then(function(e){e&&(o.pop("success","Success!",""),n.reload())})}}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZvcm1zL0Zvcm1Gb3VyQ3RybC5qcyJdLCJuYW1lcyI6WyJhbmd1bGFyIiwibW9kdWxlIiwiY29udHJvbGxlciIsIiRzY29wZSIsIiRzdGF0ZSIsIiRzdGF0ZVBhcmFtcyIsInRvYXN0ZXIiLCJGb3JtU2VydmljZSIsIiRmaWx0ZXIiLCIkaHR0cCIsInVuZGVyc2NvcmUiLCJRdWVzdGlvblNlcnZpY2UiLCJVc2VyU2VydmljZSIsIkNvbW1lbnRTZXJ2aWNlIiwiZ2V0UXVlc3Rpb25zIiwiU2hvdyIsImZvcm1faWQiLCJ0aGVuIiwicmVzcG9uc2UiLCJnZXRRdWVzdGlvbkJ5UG9zaXRpb24iLCJwb3NpdGlvbiIsInF1ZXN0aW9uIiwiZmluZCIsImRhdGEiLCJxdWVzdGlvbnMiLCJpdGVtIiwiY2hlY2siLCJzYXZlIiwiaWQiLCJVcGRhdGUiLCJKU09OIiwic3RyaW5naWZ5IiwicG9wIiwiaXNFbXB0eSIsInBhcnNlIiwicTFfaG90IiwicTFfY29udGFpbmVyIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIkhhbmRzb250YWJsZSIsImNvbHVtbnMiLCJ0eXBlIiwic291cmNlIiwiY2VsbHMiLCJyIiwiYyIsImNlbGxQcm9wZXJ0aWVzIiwidXNlcnMiLCJzdG9yZUFzc2lnbiIsImFyciIsImZvckVhY2giLCJ2IiwiayIsInB1c2giLCJTdG9yZUFzc2lnbiIsImVtYWlsIiwidGV4dCIsImNvbXBhbnlfaWQiLCJhc3NpZ25Ub0JjcCIsIlN0b3JlUXVlc3Rpb25zVG9CY3AiLCJzdWNjZXNzIiwiZXJyb3IiLCJtZXNzYWdlIiwic2VsZWN0ZWRfcXVlc3Rpb24iLCJnZXRRdWVzdGlvblVzZXJzIiwidG1wX3F1ZXN0aW9uX2lkIiwiVXNlcnMiLCJ1bmFzc2lnblVzZXIiLCJEZXRhY2giLCJ2aXNpYmxlUmVwbHlGb3JtIiwiZ2xvYmFsX2Zvcm0iLCJlbGVtZW50IiwicXVlcnlTZWxlY3RvciIsInNob3dSZXBseUZvcm0iLCJpbmRleCIsImNvbnNvbGUiLCJsb2ciLCJ0ZW1wX2NvbW1lbnRfaWQiLCJ0ZW1wX2NvbW1lbnRfaW5kZXgiLCJ0bXBfZm9ybSIsImFwcGVuZCIsImNvbW1lbnRzIiwiZ2V0QWxsQ29tbWVudHMiLCJHZXRUb1F1ZXN0aW9uIiwicmVzIiwibmV3X2NvbW1lbnQiLCJjb21tZW50X3RtcF9yZXBseSIsInN0b3JlQ29tbWVudCIsInJlcGx5X3RvIiwiY29tbWVudCIsInF1ZXN0aW9uX2lkIiwicmVwbHkiLCJTdG9yZSIsImFwcHJvdmVRdWVzdGlvbiIsIkFwcHJvdmUiLCJyZWxvYWQiLCJkaXNhcHByb3ZlUXVlc3Rpb24iLCJEaXNhcHByb3ZlIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUNBQSxTQUFRQyxPQUFPLFVBQVVDLFdBQVcsZ0JBQWlCLFNBQVUsU0FBVSxlQUFnQixVQUFXLGNBQWUsVUFBVyxRQUFTLGFBQWMsa0JBQW9CLGNBQWUsaUJBQWtCLFNBQVNDLEVBQVFDLEVBQVFDLEVBQWNDLEVBQVNDLEVBQWFDLEVBQVNDLEVBQU9DLEVBQVlDLEVBQWlCQyxFQUFhQyxHQUs3VCxRQUFTQyxLQUNMUCxFQUFZUSxLQUFLVixFQUFhVyxTQUFTQyxLQUFLLFNBQVVDLEdBR2xELFFBQVNDLEdBQXNCQyxHQUMzQixHQUFJQyxHQUFXWCxFQUFXWSxLQUFLSixFQUFTSyxLQUFLQyxVQUFXLFNBQVVDLEdBQzlELE1BQU9BLEdBQUtMLFVBQVlBLEdBSzVCLE9BSHVCLG1CQUFaQyxLQUNQQSxFQUFTSyxPQUFRLEdBRWRMLEVBaUJYLEdBMUJBbEIsRUFBT3FCLGFBZVByQixFQUFPd0IsS0FBTyxTQUFVQyxHQUNwQmpCLEVBQWdCa0IsT0FBTzFCLEVBQU9xQixVQUFVSSxHQUFJQSxHQUFJRSxLQUFLQyxVQUFVNUIsRUFBT3FCLFVBQVVJLEdBQUlMLE9BQU9OLEtBQUssU0FBVUMsR0FDdEdaLEVBQVEwQixJQUFJLFVBQVcsV0FBWSxPQVEzQzdCLEVBQU9xQixVQUFVLEdBQUtMLEVBQXNCLEdBQ3hDaEIsRUFBT3FCLFVBQVUsR0FBSSxDQUNqQmQsRUFBV3VCLFFBQVE5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QUFZLElBQ25DNUIsRUFBTzJGLGFBTW5CNUYsRUFBTzZGLG1CQUFxQixTQUFTcEUsR0FDakNqQixFQUFnQnNGLFdBQVdyRSxHQUFJWCxLQUFLLFNBQVVtRSxHQUN2Q0EsSUFDQzlFLEVBQVEwQixJQUFJLFVBQVcsV0FBWSxJQUNuQzVCLEVBQU8yRiIsImZpbGUiOiJmb3Jtcy9Gb3JtRm91ckN0cmwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5hbmd1bGFyLm1vZHVsZSgnQmZjQXBwJykuY29udHJvbGxlcignRm9ybUZvdXJDdHJsJywgWyckc2NvcGUnLCAnJHN0YXRlJywgJyRzdGF0ZVBhcmFtcycsICd0b2FzdGVyJywgJ0Zvcm1TZXJ2aWNlJywgJyRmaWx0ZXInLCAnJGh0dHAnLCAndW5kZXJzY29yZScsICdRdWVzdGlvblNlcnZpY2UnLCAgJ1VzZXJTZXJ2aWNlJywgJ0NvbW1lbnRTZXJ2aWNlJywgZnVuY3Rpb24oJHNjb3BlLCAkc3RhdGUsICRzdGF0ZVBhcmFtcywgdG9hc3RlciwgRm9ybVNlcnZpY2UsICRmaWx0ZXIsICRodHRwLCB1bmRlcnNjb3JlLCBRdWVzdGlvblNlcnZpY2UsIFVzZXJTZXJ2aWNlLCBDb21tZW50U2VydmljZSkge1xuXG4gICAgLypcbiAgICAgVG9kbyAtIEZyb20gNCBmdW5jdGlvbmFsXG4gICAgICovXG4gICAgZnVuY3Rpb24gZ2V0UXVlc3Rpb25zKCkge1xuICAgICAgICBGb3JtU2VydmljZS5TaG93KCRzdGF0ZVBhcmFtcy5mb3JtX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgJHNjb3BlLnF1ZXN0aW9ucyA9IFtdO1xuXG4gICAgICAgICAgICBmdW5jdGlvbiBnZXRRdWVzdGlvbkJ5UG9zaXRpb24ocG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICB2YXIgcXVlc3Rpb24gPSB1bmRlcnNjb3JlLmZpbmQocmVzcG9uc2UuZGF0YS5xdWVzdGlvbnMsIGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBpdGVtLnBvc2l0aW9uID09IHBvc2l0aW9uO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcXVlc3Rpb24gIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICAgICAgcXVlc3Rpb24uY2hlY2sgPSB0cnVlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm4gcXVlc3Rpb247XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgU2F2ZSBxdWVzdGlvblxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAkc2NvcGUuc2F2ZSA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAgICAgICAgIFF1ZXN0aW9uU2VydmljZS5VcGRhdGUoJHNjb3BlLnF1ZXN0aW9uc1tpZF0uaWQsIEpTT04uc3RyaW5naWZ5KCRzY29wZS5xdWVzdGlvbnNbaWRdLmRhdGEpKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsIFwiU3VjY2VzcyFcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9O1xuXG5cbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICAgUXVlc3Rpb24gMVxuICAgICAgICAgICAgICovXG4gICAgICAgICAgICAkc2NvcGUucXVlc3Rpb25zWzFdID0gZ2V0UXVlc3Rpb25CeVBvc2l0aW9uKDEpO1xuICAgICAgICAgICAgaWYgKCRzY29wZS5xdWVzdGlvbnNbMV0pIHtcbiAgICAgICAgICAgICAgICBpZiAodW5kZXJzY29yZS5pc0VtcHR5KCRzY29wZS5xdWVzdGlvbnNbMV0uZGF0YSkpIHtcbiAgICAgICAgICAgICAgICAgICAgJHNjb3BlLnF1ZXN0aW9uc1sxXS5kYXRhID0gW1xuICAgICAgICAgICAgICAgICAgICAgICAgWydJbmRpY2F0b3IgW3BydWRlbnRpYWwgYWNyb255bV0nLCAnUmVxdWlyZW1lbnQnLCAnQWN0dWFsIHZhbHVlIDEnLCAnQ29tcGxpZWQgKFkvTiknLCAnSWYgbm90IGNvbXBsaWVkLCBwbGVhc2UgcHJvdmlkZSBkZXRhaWxzIDInXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgICAgIFsnJywgJycsICcnLCAnJywgJycsICcnXSxcbiAgICAgICAgICAgICAgICAgICAgXTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkc2NvcGUucXVlc3Rpb25zWzFdLmRhdGEgPSBKU09OLnBhcnNlKCRzY29wZS5xdWVzdGlvbnNbMV0uZGF0YSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgdmFyIHExX2NvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdxdWVzdGlvbl8xJyksXG4gICAgICAgICAgICAgICAgICAgIHExX2hvdDtcblxuICAgICAgICAgICAgICAgIHExX2hvdCA9IG5ldyBIYW5kc29udGFibGUocTFfY29udGFpbmVyLCB7XG4gICAgICAgICAgICAgICAgICAgIGRhdGE6ICRzY29wZS5xdWVzdGlvbnNbMV0uZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgY29sdW1uczogW1xuICAgICAgICAgICAgICAgICAgICAgICAge30sXG4gICAgICAgICAgICAgICAgICAgICAgICB7fSxcbiAgICAgICAgICAgICAgICAgICAgICAgIHt9LFxuICAgICAgICAgICAgICAgICAgICAgICAge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICdkcm9wZG93bicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc291cmNlOiBbJ3llcycsICdubyddXG4gICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAge31cbiAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgICAgICAgICAgICAgY2VsbHM6IGZ1bmN0aW9uIChyLCBjKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2VsbFByb3BlcnRpZXM7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAociA9PT0gMCAmJiBjID09PSAzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2VsbFByb3BlcnRpZXMgPSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6ICd0ZXh0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNlbGxQcm9wZXJ0aWVzO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9LFxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgIEVuZCBRdWVzdGlvbiAxXG4gICAgICAgICAgICAgKi9cblxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZ2V0UXVlc3Rpb25zKCk7XG5cbiAgICAvKlxuICAgICBBc3NpZ24gZnVuY3Rpb25hbFxuICAgICAqL1xuICAgICRzY29wZS51c2VycyA9IFtdO1xuICAgIC8qXG4gICAgIFRvZG8gLSBBc3NpZ24gcXVlc3Rpb25zIHRvIHVzZXIgKCsgY3JlYXRlIG5ldyB1c2VyKSByb2xlXG4gICAgICovXG4gICAgJHNjb3BlLnN0b3JlQXNzaWduID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJyID0gW107XG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUucXVlc3Rpb25zLCBmdW5jdGlvbiAodixrKSB7XG4gICAgICAgICAgICBpZih2KXtcbiAgICAgICAgICAgICAgICBpZih2LmNoZWNrKXtcbiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2godi5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBVc2VyU2VydmljZS5TdG9yZUFzc2lnbih7XG4gICAgICAgICAgICAnZGF0YScgOiBhcnIsXG4gICAgICAgICAgICAndXNlcnMnIDogKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUudXNlcnMsIGZ1bmN0aW9uICh2LGspIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdlbWFpbCcgOiB2LnRleHRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH0oKSlcbiAgICAgICAgfSwgJHN0YXRlUGFyYW1zLmNvbXBhbnlfaWQsICRzdGF0ZVBhcmFtcy5mb3JtX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCBcIlN1Y2Nlc3MhXCIsIFwiXCIpO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLypcbiAgICAgVG9kbyAtIEFzc2lnbiBxdWVzdGlvbnMgdG8gQkNwIHJvbGVcbiAgICAgKi9cbiAgICAkc2NvcGUuYXNzaWduVG9CY3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcnIgPSBbXTtcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5xdWVzdGlvbnMsIGZ1bmN0aW9uICh2LGspIHtcbiAgICAgICAgICAgIGlmKHYuY2hlY2spe1xuICAgICAgICAgICAgICAgIGFyci5wdXNoKHYuaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgVXNlclNlcnZpY2UuU3RvcmVRdWVzdGlvbnNUb0JjcCgkc3RhdGVQYXJhbXMuY29tcGFueV9pZCwgJHN0YXRlUGFyYW1zLmZvcm1faWQsIGFycikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHRvYXN0ZXIucG9wKCdzdWNjZXNzJywgXCJTdWNjZXNzIVwiLCBcIlwiKTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qXG4gICAgIEVORCBBc3NpZ24gZnVuY3Rpb25hbFxuICAgICAqL1xuXG5cbiAgICAvKlxuICAgICBBc3NpZ24gZnVuY3Rpb25hbFxuICAgICAqL1xuICAgICRzY29wZS51c2VycyA9IFtdO1xuICAgIC8qXG4gICAgIFRvZG8gLSBBc3NpZ24gcXVlc3Rpb25zIHRvIHVzZXIgKCsgY3JlYXRlIG5ldyB1c2VyKSByb2xlXG4gICAgICovXG4gICAgJHNjb3BlLnN0b3JlQXNzaWduID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgYXJyID0gW107XG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUucXVlc3Rpb25zLCBmdW5jdGlvbiAodixrKSB7XG4gICAgICAgICAgICBpZih2KXtcbiAgICAgICAgICAgICAgICBpZih2LmNoZWNrKXtcbiAgICAgICAgICAgICAgICAgICAgYXJyLnB1c2godi5pZCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcblxuICAgICAgICBVc2VyU2VydmljZS5TdG9yZUFzc2lnbih7XG4gICAgICAgICAgICAnZGF0YScgOiBhcnIsXG4gICAgICAgICAgICAndXNlcnMnIDogKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgZGF0YSA9IFtdO1xuICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUudXNlcnMsIGZ1bmN0aW9uICh2LGspIHtcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICdlbWFpbCcgOiB2LnRleHRcbiAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZGF0YTtcbiAgICAgICAgICAgIH0oKSlcbiAgICAgICAgfSwgJHN0YXRlUGFyYW1zLmNvbXBhbnlfaWQsICRzdGF0ZVBhcmFtcy5mb3JtX2lkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgaWYocmVzcG9uc2Uuc3VjY2Vzcyl7XG4gICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCBcIlN1Y2Nlc3MhXCIsIFwiXCIpO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJlc3BvbnNlLmVycm9yLCBmdW5jdGlvbiAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKGVycm9yLCBmdW5jdGlvbiAobWVzc2FnZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ2Vycm9yJywgXCJcIiwgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLypcbiAgICAgVG9kbyAtIEFzc2lnbiBxdWVzdGlvbnMgdG8gQkNwIHJvbGVcbiAgICAgKi9cbiAgICAkc2NvcGUuYXNzaWduVG9CY3AgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBhcnIgPSBbXTtcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5xdWVzdGlvbnMsIGZ1bmN0aW9uICh2LGspIHtcbiAgICAgICAgICAgIGlmKHYuY2hlY2spe1xuICAgICAgICAgICAgICAgIGFyci5wdXNoKHYuaWQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgVXNlclNlcnZpY2UuU3RvcmVRdWVzdGlvbnNUb0JjcCgkc3RhdGVQYXJhbXMuY29tcGFueV9pZCwgJHN0YXRlUGFyYW1zLmZvcm1faWQsIGFycikudGhlbihmdW5jdGlvbiAocmVzcG9uc2UpIHtcbiAgICAgICAgICAgIGlmKHJlc3BvbnNlLnN1Y2Nlc3Mpe1xuICAgICAgICAgICAgICAgIHRvYXN0ZXIucG9wKCdzdWNjZXNzJywgXCJTdWNjZXNzIVwiLCBcIlwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qXG4gICAgIEVORCBBc3NpZ24gZnVuY3Rpb25hbFxuICAgICAqL1xuXG5cbiAgICAvKlxuICAgICBVbmFzc2lnbiBmdW5jdGlvbmFsXG4gICAgICovXG5cbiAgICAvKlxuICAgICBUb2RvIC0gR2V0IHVzZXJzIHRvIHF1ZXN0aW9uc1xuICAgICAqL1xuICAgICRzY29wZS5zZWxlY3RlZF9xdWVzdGlvbiA9IHt9O1xuICAgICRzY29wZS5nZXRRdWVzdGlvblVzZXJzID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgICRzY29wZS50bXBfcXVlc3Rpb25faWQgPSBpZDtcbiAgICAgICAgUXVlc3Rpb25TZXJ2aWNlLlVzZXJzKGlkKS50aGVuKGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgJHNjb3BlLnNlbGVjdGVkX3F1ZXN0aW9uLnVzZXJzID0gcmVzcG9uc2UuZGF0YTtcbiAgICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8qXG4gICAgIFRvZG8gLSBVbmFzc2lnbiB1c2VyIGZyb20gcXVlc3Rpb25cbiAgICAgKi9cbiAgICAkc2NvcGUudW5hc3NpZ25Vc2VyID0gZnVuY3Rpb24gKGlkKSB7XG4gICAgICAgIFF1ZXN0aW9uU2VydmljZS5EZXRhY2goJHNjb3BlLnRtcF9xdWVzdGlvbl9pZCwgaWQpLnRoZW4oZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICBpZihyZXNwb25zZS5zdWNjZXNzKXtcbiAgICAgICAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsIFwiU3VjY2VzcyFcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgJHNjb3BlLmdldFF1ZXN0aW9uVXNlcnMoJHNjb3BlLnRtcF9xdWVzdGlvbl9pZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvKlxuICAgICBFTkQgVW5hc3NpZ24gZnVuY3Rpb25hbFxuICAgICAqL1xuXG5cblxuICAgIC8qXG4gICAgIFRvZG8gLSBDb21tZW50cyBmdW5jdGlvbmFsXG4gICAgICovXG5cbiAgICAvLyBTaG93IHJlcGx5IGZvcm1cbiAgICAkc2NvcGUudmlzaWJsZVJlcGx5Rm9ybSA9IGZhbHNlO1xuICAgIHZhciBnbG9iYWxfZm9ybSA9IGFuZ3VsYXIuZWxlbWVudCggZG9jdW1lbnQucXVlcnlTZWxlY3RvciggJyNnbG9iYWxfYWRkX2NvbW1lbnRzX2Zvcm0nKSApO1xuICAgICRzY29wZS5zaG93UmVwbHlGb3JtID0gZnVuY3Rpb24oaWQsIGluZGV4KXtcbiAgICAgICAgY29uc29sZS5sb2coaWQsIGluZGV4KTtcbiAgICAgICAgJHNjb3BlLnRlbXBfY29tbWVudF9pZCA9IGlkO1xuICAgICAgICAkc2NvcGUudGVtcF9jb21tZW50X2luZGV4ID0gaW5kZXg7XG4gICAgICAgIHZhciB0bXBfZm9ybSA9IGFuZ3VsYXIuZWxlbWVudCggZG9jdW1lbnQucXVlcnlTZWxlY3RvciggJyN0bXBfYWRkX2NvbW1lbnRzX2Zvcm0nK2lkKSApO1xuICAgICAgICB0bXBfZm9ybS5hcHBlbmQoZ2xvYmFsX2Zvcm0pO1xuICAgICAgICAkc2NvcGUudmlzaWJsZVJlcGx5Rm9ybSA9ICEkc2NvcGUudmlzaWJsZVJlcGx5Rm9ybTtcbiAgICB9O1xuXG4gICAgLy8gR2V0IGFsbCBjb21tZW50IHRvIHF1ZXN0aW9uc1xuICAgICRzY29wZS5jb21tZW50cyA9IFtdO1xuICAgICRzY29wZS5nZXRBbGxDb21tZW50cyA9IGZ1bmN0aW9uIChpZCkge1xuICAgICAgICAkc2NvcGUudG1wX3F1ZXN0aW9uX2lkID0gaWQ7XG4gICAgICAgIENvbW1lbnRTZXJ2aWNlLkdldFRvUXVlc3Rpb24oaWQpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgJHNjb3BlLmNvbW1lbnRzID0gcmVzO1xuICAgICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gU3RvcmUgbmV3IGNvbW1lbnRcbiAgICAkc2NvcGUubmV3X2NvbW1lbnQgPSAnJztcbiAgICAkc2NvcGUuY29tbWVudF90bXBfcmVwbHkgPSAnJztcbiAgICAkc2NvcGUuc3RvcmVDb21tZW50ID0gZnVuY3Rpb24gKHJlcGx5X3RvLCBpbmRleCkge1xuICAgICAgICB2YXIgZGF0YSA9IHtcbiAgICAgICAgICAgICdjb21tZW50Jzokc2NvcGUubmV3X2NvbW1lbnQsXG4gICAgICAgICAgICAncXVlc3Rpb25faWQnOiRzY29wZS50bXBfcXVlc3Rpb25faWQsXG4gICAgICAgIH07XG4gICAgICAgIGlmKHR5cGVvZiByZXBseV90byAhPSAndW5kZWZpbmVkJyl7XG4gICAgICAgICAgICBkYXRhLmNvbW1lbnQgPSAkc2NvcGUuY29tbWVudF90bXBfcmVwbHk7XG4gICAgICAgICAgICBkYXRhLnJlcGx5ID0gMTtcbiAgICAgICAgICAgIGRhdGEucmVwbHlfdG8gPSByZXBseV90bztcbiAgICAgICAgfTtcbiAgICAgICAgQ29tbWVudFNlcnZpY2UuU3RvcmUoZGF0YSkudGhlbihmdW5jdGlvbiAocmVzKSB7XG4gICAgICAgICAgICBpZihyZXMuc3VjY2Vzcyl7XG4gICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCBcIlN1Y2Nlc3MhXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgICRzY29wZS5uZXdfY29tbWVudCA9ICcnO1xuICAgICAgICAgICAgICAgIC8vIGlmKHR5cGVvZiBpbmRleCAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIC8vICAgICAkc2NvcGUuY29tbWVudHNbaW5kZXhdLnRtcF9yZXBseSA9ICcnO1xuICAgICAgICAgICAgICAgIC8vIH07XG4gICAgICAgICAgICAgICAgaWYodHlwZW9mIGluZGV4ID09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgICAgICRzY29wZS5nZXRBbGxDb21tZW50cygkc2NvcGUudG1wX3F1ZXN0aW9uX2lkKTtcbiAgICAgICAgICAgICAgICB9O1xuXG4gICAgICAgICAgICAgICAgLy8gcmVsb2FkIGFsbCBjb21tZW50c1xuICAgICAgICAgICAgICAgICRzY29wZS52aXNpYmxlUmVwbHlGb3JtID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgLy8gJHNjb3BlLmdldEFsbENvbW1lbnRzKCRzY29wZS50bXBfcXVlc3Rpb25faWQpO1xuICAgICAgICAgICAgICAgICRzY29wZS5jb21tZW50X3RtcF9yZXBseSA9ICcnO1xuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgYW5ndWxhci5mb3JFYWNoKHJlcy5lcnJvciwgZnVuY3Rpb24gKGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGFuZ3VsYXIuZm9yRWFjaChlcnJvciwgZnVuY3Rpb24gKG1lc3NhZ2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvYXN0ZXIucG9wKCdlcnJvcicsIFwiXCIsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICAvKlxuICAgICBFTkQgQ29tbWVudHMgZnVuY3Rpb25hbFxuICAgICAqL1xuXG5cbiAgICAvKlxuICAgICBUb2RvIC0gQXBwcm92ZSAvIERpc2FwcHJvdmUgZnVuY3Rpb25hbFxuICAgICAqL1xuICAgICRzY29wZS5hcHByb3ZlUXVlc3Rpb24gPSBmdW5jdGlvbihpZCl7XG4gICAgICAgIFF1ZXN0aW9uU2VydmljZS5BcHByb3ZlKGlkKS50aGVuKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgIGlmKHJlcyl7XG4gICAgICAgICAgICAgICAgdG9hc3Rlci5wb3AoJ3N1Y2Nlc3MnLCBcIlN1Y2Nlc3MhXCIsIFwiXCIpO1xuICAgICAgICAgICAgICAgICRzdGF0ZS5yZWxvYWQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcblxuXG4gICAgJHNjb3BlLmRpc2FwcHJvdmVRdWVzdGlvbiA9IGZ1bmN0aW9uKGlkKXtcbiAgICAgICAgUXVlc3Rpb25TZXJ2aWNlLkRpc2FwcHJvdmUoaWQpLnRoZW4oZnVuY3Rpb24gKHJlcykge1xuICAgICAgICAgICAgaWYocmVzKXtcbiAgICAgICAgICAgICAgICB0b2FzdGVyLnBvcCgnc3VjY2VzcycsIFwiU3VjY2VzcyFcIiwgXCJcIik7XG4gICAgICAgICAgICAgICAgJHN0YXRlLnJlbG9hZCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIC8qXG4gICAgIEVORCBBcHByb3ZlIC8gRGlzYXBwcm92ZSBmdW5jdGlvbmFsXG4gICAgICovXG5cbn1dKTsiXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
